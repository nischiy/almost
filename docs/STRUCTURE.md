# Project Structure & Relations (cleaned)

This document explains each folder/file and how components interact.

## Top-level overview
- **app/** â€” application entry logic and orchestration (`TraderApp`). Contains continuous runner and single-tick logic.
- **core/** â€” domain logic split by responsibilities (precision, risk, execution, telemetry, indicators, filters).
- **models/** â€” saved strategy parameters, best configs, and tuning artifacts.
- **tests/** â€” smoke/unit/integration tests.
- **docs/** â€” docs and runbooks. This file (`STRUCTURE.md`) is generated automatically.
- **scripts/** â€” helper scripts (diagnostics/tuning/maintenance).
- **logs/** â€” runtime outputs: snapshots, decisions, orders, equity, health (created at runtime).

## Key components and relations
- `app/run.py:TraderApp` orchestrates a full cycle:
  1) public API checks (ping/time) â†’ 2) fetch klines â†’ 3) compute indicators/filters â†’ 4) **risk guard** â†’ 5) execution (paper or live) â†’ 6) telemetry.
- `core/precision.py` provides `get_filters`, `round_price`, `round_qty`, `enforce_min_notional`. Used by `TraderApp` and live execution.
- `core/risk/` exports `normalize_price/qty` and `can_open_new_trade(...)` (tuple form). Called before any live entry.
- `core/execution/` has:
    - `binance_futures.py` â€” signing and HTTP calls for Binance Futures (now respects `BINANCE_TESTNET`).
    - `binance_exec.py` â€” high-level placement helpers (entry + protective SL/TP).
- `core/telemetry/` writes snapshots (`parquet`), decisions (`csv`), and health (`jsonl`/`md`). Called from `TraderApp` after each cycle.
- `core/filters/gates.py` uses latest snapshot to gate trading by ATR percentiles and time windows.
- `models/ema_rsi_atr/best_params.json` is the **single source of truth** for strategy params; `models/best_params.json` mirrors it for convenience.

## ENV (unified keys used project-wide)
- `PAPER_TRADING` (0/1)
- `TRADE_ENABLED` (0/1) â€” only effective when `PAPER_TRADING=0`
- `BINANCE_TESTNET` (0/1)
- `SYMBOL`, `INTERVAL`
- Risk & sizing: `TRADE_RISK_USD`, `PAPER_RISK_USD`, `SL_*`, `TP_*`, `RISK_*`
- Runner: `LOOP_SLEEP_SEC`


## Cleaned tree
- ğŸ“„ --help
- ğŸ“„ .editorconfig
- ğŸ“„ .env.compat.additions
- ğŸ“„ .env.example
- ğŸ“„ .env.example.additions.txt
- ğŸ“„ .env.example.append.txt
- ğŸ“„ .env.example.core_additions.txt
- ğŸ“„ .env.example.execution_pack
- ğŸ“„ .env.patched
- ğŸ“„ .env.risk.example.additions
- ğŸ“„ PATCH_NOTES.txt
- ğŸ“„ PATCH_README_v2.txt
- ğŸ“ README/
- ğŸ“„ README/README_CORE_TESTS.md
- ğŸ“„ README/README_PREFLIGHT_V2.md
- ğŸ“„ README/README_TESTS_CORE_ONLY.md
- ğŸ“„ README/README_TESTS_FIX.md
- ğŸ“„ README/README_TESTS_HOTFIX.md
- ğŸ“„ README/README_TESTS_PHASE_A.md
- ğŸ“„ README/README_TESTS_PHASE_A_FULLREFRESH.md
- ğŸ“„ README/README_TESTS_PHASE_B_CONTRACTS.md
- ğŸ“„ README.md
- ğŸ“„ README.txt
- ğŸ“„ README_ADAPTER_PACK.md
- ğŸ“„ README_AUTO_EXITS.md
- ğŸ“„ README_BACKTEST.md
- ğŸ“„ README_BTC_ONLY.txt
- ğŸ“„ README_CFG_DEFAULTS.md
- ğŸ“„ README_CFG_DIAGNOSTICS.md
- ğŸ“„ README_CONFIG_FIX.txt
- ğŸ“„ README_ENV_LOADER.md
- ğŸ“„ README_FIXPACK_B.md
- ğŸ“„ README_FIXPACK_C.md
- ğŸ“„ README_FIXPACK_D.md
- ğŸ“„ README_FIXPACK_E.md
- ğŸ“„ README_FIXPACK_F.md
- ğŸ“„ README_FIXPACK_G.md
- ğŸ“„ README_FIXPACK_I.md
- ğŸ“„ README_FIXPACK_J.md
- ğŸ“„ README_FIX_RUN_INDENT.txt
- ğŸ“„ README_LIVE_BRIDGE_FIX.md
- ğŸ“„ README_LOGGING_PACK.md
- ğŸ“„ README_ORDER_DRY_RUN.md
- ğŸ“„ README_PATCH.md
- ğŸ“„ README_PATCH.txt
- ğŸ“„ README_POSITION_PACK.md
- ğŸ“„ README_POSITION_SIZER.md
- ğŸ“„ README_POSITION_SIZER_v2.md
- ğŸ“„ README_RELEASE.md
- ğŸ“„ README_RELEASE_GO_LIVE.md
- ğŸ“„ README_RISK_GUARD.md
- ğŸ“„ README_SAFE_ADDONS.md
- ğŸ“„ README_SAFE_UPDATE.md
- ğŸ“„ README_SENDER_PACK.md
- ğŸ“„ README_TRADE_GLUE_PACK.md
- ğŸ“„ RELEASE_CHECKLIST.md
- ğŸ“„ RUNBOOK_LIVE.md
- ğŸ“„ SURPRISE_TOOLS_README.md
- ğŸ“„ UPDATE_NOTES.txt
- ğŸ“„ UPGRADE_LIVE_CHECKS_README.md
- ğŸ“ app/
- ğŸ“„ app/__init__.py
- ğŸ“„ app/entrypoint.py
- ğŸ“„ app/run.py
- ğŸ“ core/
- ğŸ“„ core/__init__.py
- ğŸ“ core/config/
- ğŸ“„ core/config/__init__.py
- ğŸ“„ core/config/best_params.py
- ğŸ“„ core/config/loader.py
- ğŸ“„ core/env_loader.py
- ğŸ“ core/exchange/
- ğŸ“„ core/exchange/__init__.py
- ğŸ“„ core/exchange/symbol_info.py
- ğŸ“„ core/exchange_private.py
- ğŸ“ core/execution/
- ğŸ“„ core/execution/binance_exec.py
- ğŸ“„ core/execution/binance_futures.py
- ğŸ“ core/filters/
- ğŸ“„ core/filters/gates.py
- ğŸ“ core/filters_pkg/
- ğŸ“„ core/filters_pkg/core\filters_pkg\
- ğŸ“ core/indicators/
- ğŸ“„ core/indicators/core\indicators\
- ğŸ“„ core/indicators.py
- ğŸ“„ core/live_guard.py
- ğŸ“ core/logic/
- ğŸ“„ core/logic/core\logic\
- ğŸ“„ core/paper.py
- ğŸ“„ core/params_loader.py
- ğŸ“ core/positions/
- ğŸ“„ core/positions/portfolio.py
- ğŸ“„ core/precision.py
- ğŸ“ core/risk/
- ğŸ“„ core/risk/__init__.py
- ğŸ“„ core/risk_guard.py
- ğŸ“„ core/strategy.py
- ğŸ“ core/telemetry/
- ğŸ“„ core/telemetry/__init__.py
- ğŸ“„ core/telemetry/health.py
- ğŸ“ core/utils/
- ğŸ“„ core/utils/filters_patch.py
- ğŸ“ docs/
- ğŸ“„ docs/playbook_safety.md
- ğŸ“„ docs/release_readiness_report.md
- ğŸ“ docs/smoke/
- ğŸ“„ docs/smoke/README.md
- ğŸ“„ main.py
- ğŸ“„ make_archive.bat
- ğŸ“„ make_archive.ps1
- ğŸ“ models/
- ğŸ“„ models/best_params.json
- ğŸ“ models/ema_rsi_atr/
- ğŸ“„ models/ema_rsi_atr/best_params.json
- ğŸ“ models/frozen/
- ğŸ“„ models/frozen/20250916T190737_ema_rsi_atr.json
- ğŸ“„ models/last_used_params.json
- ğŸ“„ models/optuna_tune.db
- ğŸ“„ models/self_test_touch.bin
- ğŸ“ patches/
- ğŸ“ patches/scripts/
- ğŸ“„ patches/scripts/patches\scripts\
- ğŸ“„ pytest.ini
- ğŸ“„ requirements.append.txt
- ğŸ“„ requirements.txt
- ğŸ“ risk/
- ğŸ“„ risk/__init__.py
- ğŸ“„ risk/limits.py
- ğŸ“„ risk.py
- ğŸ“„ run_fix.bat
- ğŸ“„ run_tests.ps1
- ğŸ“ scripts/
- ğŸ“„ scripts/auto_tune.ps1
- ğŸ“„ scripts/calibrate_quick.ps1
- ğŸ“„ scripts/check_all.ps1
- ğŸ“„ scripts/check_binance_client.py
- ğŸ“„ scripts/clean_duplicates.bat
- ğŸ“„ scripts/clean_duplicates.ps1
- ğŸ“„ scripts/clean_project.ps1
- ğŸ“„ scripts/clean_safe.ps1
- ğŸ“„ scripts/clean_safely.ps1
- ğŸ“„ scripts/cleanup_project.ps1
- ğŸ“„ scripts/diagnose_entry.py
- ğŸ“„ scripts/diagnose_sitecustomize.py
- ğŸ“ scripts/diagnostics/
- ğŸ“„ scripts/diagnostics/btc_only.ps1
- ğŸ“„ scripts/diagnostics/cancel_all_cli.py
- ğŸ“„ scripts/diagnostics/leverage_sizer_cli.py
- ğŸ“„ scripts/diagnostics/leverage_sizer_standalone.py
- ğŸ“„ scripts/diagnostics/list_open_orders.py
- ğŸ“„ scripts/diagnostics/list_positions.py
- ğŸ“„ scripts/diagnostics/log_preflight.py
- ğŸ“„ scripts/diagnostics/log_sizer.py
- ğŸ“„ scripts/diagnostics/order_dry_run.py
- ğŸ“„ scripts/diagnostics/order_preview_cli.py
- ğŸ“„ scripts/diagnostics/order_send_cli.py
- ğŸ“„ scripts/diagnostics/order_send_live_auto_cli.py
- ğŸ“„ scripts/diagnostics/order_send_live_cli.py
- ğŸ“„ scripts/diagnostics/preflight_v2.py
- ğŸ“„ scripts/diagnostics/qty_guard_example.py
- ğŸ“„ scripts/diagnostics/risk_guard_check.py
- ğŸ“„ scripts/diagnostics/set_tp_sl_cli.py
- ğŸ“„ scripts/diagnostics/size_advisor.py
- ğŸ“„ scripts/diagnostics/trade_once.py
- ğŸ“„ scripts/kill_stuck_pytest.ps1
- ğŸ“ scripts/live/
- ğŸ“„ scripts/live/check_account.ps1
- ğŸ“„ scripts/live/ping_exchange.ps1
- ğŸ“„ scripts/live/read_ticker.ps1
- ğŸ“„ scripts/load_env.ps1
- ğŸ“ scripts/maintenance/
- ğŸ“„ scripts/maintenance/log_rotate.ps1
- ğŸ“„ scripts/make_clean_archive.ps1
- ğŸ“„ scripts/one_go.ps1
- ğŸ“ scripts/paper/
- ğŸ“„ scripts/paper/README.txt
- ğŸ“„ scripts/paper/report.ps1
- ğŸ“„ scripts/paper/run_dry_loop.ps1
- ğŸ“„ scripts/paper/run_paper.ps1
- ğŸ“„ scripts/paper/show_last.ps1
- ğŸ“„ scripts/patch_run_fix.ps1
- ğŸ“„ scripts/patch_run_fix2.ps1
- ğŸ“„ scripts/patch_run_replace_block.ps1
- ğŸ“„ scripts/patch_strategy_export.py
- ğŸ“„ scripts/preflight.ps1
- ğŸ“„ scripts/preflight_all.py
- ğŸ“„ scripts/preflight_live.py
- ğŸ“„ scripts/print_last_health_links.ps1
- ğŸ“„ scripts/print_last_health_links.py
- ğŸ“„ scripts/print_last_trading_links.cmd
- ğŸ“„ scripts/print_last_trading_links.ps1
- ğŸ“„ scripts/print_last_trading_links.py
- ğŸ“„ scripts/prod_step1_precision.py
- ğŸ“„ scripts/quick_check.ps1
- ğŸ“„ scripts/quick_sweep.ps1
- ğŸ“„ scripts/release_check.ps1
- ğŸ“„ scripts/replace_tests_with_core.ps1
- ğŸ“ scripts/run/
- ğŸ“„ scripts/run/loop_live_safe.py
- ğŸ“„ scripts/run/loop_preview.py
- ğŸ“„ scripts/run_all_checks.ps1
- ğŸ“„ scripts/run_live.ps1
- ğŸ“„ scripts/run_paper.ps1
- ğŸ“„ scripts/run_project_check.ps1
- ğŸ“„ scripts/run_pytest.ps1
- ğŸ“„ scripts/run_pytest_fast.ps1
- ğŸ“„ scripts/run_self_check.ps1
- ğŸ“„ scripts/run_self_check_core.ps1
- ğŸ“„ scripts/run_smoke_pipeline.ps1
- ğŸ“„ scripts/run_tests.ps1
- ğŸ“ scripts/smoke/
- ğŸ“„ scripts/smoke/run_all_checks.ps1
- ğŸ“„ scripts/smoke/run_smoke_pipeline.ps1
- ğŸ“„ scripts/smoke_run.ps1
- ğŸ“„ scripts/tests_core_only_reset.ps1
- ğŸ“ scripts/tools/
- ğŸ“„ scripts/tools/enable_trading_safe.ps1
- ğŸ“„ scripts/tools/go_live.ps1
- ğŸ“„ scripts/tools/health.ps1
- ğŸ“„ scripts/tools/load_env.ps1
- ğŸ“„ scripts/tools/panic_switch.ps1
- ğŸ“„ scripts/tools/safe_ops.ps1
- ğŸ“„ scripts/tools/trade.ps1
- ğŸ“„ scripts/tools/tradewatch.ps1
- ğŸ“„ scripts/tune.py
- ğŸ“„ sitecustomize.py
- ğŸ“ tests/
- ğŸ“„ tests/conftest.py
- ğŸ“ tests/smoke/
- ğŸ“„ tests/smoke/test_imports.py
- ğŸ“„ tests/smoke/test_indicators_smoke.py
- ğŸ“„ tests/smoke/test_strategy_smoke.py
- ğŸ“„ tests/test_app_import.py
- ğŸ“„ tests/test_indicators_basic.py
- ğŸ“„ tests/test_risk_gate.py
- ğŸ“„ tests/test_strategy_signal.py
- ğŸ“ tests_core/
- ğŸ“ tests_core/tools/
- ğŸ“„ tests_core/tools/tests_core\tools\
- ğŸ“ tools/
- ğŸ“ tools/live/
- ğŸ“„ tools/live/tools\live\
- ğŸ“ tools/paper/
- ğŸ“„ tools/paper/README.txt
- ğŸ“ tools/ps/
- ğŸ“„ tools/ps/LoadDotEnv.ps1
- ğŸ“ tools/smoke/
- ğŸ“„ tools/smoke/tools\smoke\
- ğŸ“„ tools/strip_bom.py
- ğŸ“ utils/
- ğŸ“„ utils/EXIT_PATCH_NOTE.txt
- ğŸ“„ utils/__init__.py
- ğŸ“„ utils/auto_exit_policy.py
- ğŸ“„ utils/balance_provider.py
- ğŸ“„ utils/exit_adapter.py
- ğŸ“„ utils/live_bridge.py
- ğŸ“„ utils/logrotate.py
- ğŸ“„ utils/order_adapter.py
- ğŸ“„ utils/order_service.py
- ğŸ“„ utils/position_sizer.py
- ğŸ“„ utils/risk_guard.py
- ğŸ“„ utils/sender_adapter.py
- ğŸ“„ utils/signer.py